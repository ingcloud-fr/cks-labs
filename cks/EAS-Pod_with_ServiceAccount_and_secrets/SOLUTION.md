## Solution: Pod with ServiceAccount and Mounted Secrets

### ðŸ› ï¸ Step-by-step YAMLs and CLI commands


#### 2. ServiceAccount

```
$ k create serviceaccount secret-sa -n team-red
serviceaccount/secret-sa created
```

#### 3. Secret 1 (key/value pair)

```
$ k create secret generic secret-1 --from-literal=password=1234 -n team-red
secret/secret-1 created
```

#### 4. Secret 2 (from file)

```
$ k create secret generic secret-2 --from-file=hosts=/etc/hosts -n team-red
```

#### 5. Pod using ServiceAccount and both secrets

In the Kubernetes doc, search for
-  "credentials secret" : https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/ 
- "secret" : https://kubernetes.io/docs/concepts/configuration/secret//#using-secrets-as-files-from-a-pod and search the page of the example


```
$ k -n team-red run secret-manager --image=nginx -oyaml --dry-run=client > pod.yaml
```


```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secret-manager
  namespace: team-red
spec:
  serviceAccountName: secret-sa       # ADD
  containers:
    - name: nginx
      image: nginx
      env:                            # ADD
        - name: SECRET1               # ADD
          valueFrom:                  # ADD
            secretKeyRef:             # ADD
              name: secret-1          # ADD
              key: password           # ADD
      volumeMounts:                   # ADD
        - name: secret-volume         # ADD
          mountPath: /etc/my-secret2  # ADD
          readOnly: true              # ADD
  volumes:                            # ADD
    - name: secret-volume             # ADD
      secret:                         # ADD
        secretName: secret-2          # ADD 
```

---

### âœ… Verification

1. Enter the pod:
```bash
kubectl exec -n team-red -it secret-manager -- sh
```

2. Check the environment variable:
```
#Â echo $SECRET1
1234
```

3. Check the mounted secret file:
```
# cat /etc/my-secret2/hosts
# Hosts list generated by Vagrant
127.0.0.1 localhost
# The following lines are desirable for IPv6 capable hosts
::1	ip6-localhost	ip6-loopback
fe00::0	ip6-localnet
ff00::0	ip6-mcastprefix
...
```

or :

```
$ k -n team-red exec secret-manager -- env | grep SEC
$ k -n team-red exec secret-manager -- mount | grep sec
```


### ðŸ§¹ Reset
To clean up:
```bash
./reset.sh
```

